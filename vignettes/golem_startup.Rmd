---
title: "Untitled"
author: "andy henrie"
date: "9/2/2021"
output: html_document
---
# Introduction to `{OMXR}` {#omxr}

```{=html}
<style>
img.left {
  float: left;
  margin-right: 1em;
}
</style>
```
<img src="img/thinkr-hex-golem2.png" class="left" width="20%"/>

```{r 01-omicser-1, include = FALSE}
library(omicser)
knitr::opts_chunk$set(comment = "")
```

The `{omicser}` package is a shiny app built using the `{golem}` framework for building production-grade `{shiny}` applications.

Note that the version used at the time of writing this book is `r packageVersion("golem")`.

## What is `{omicser}`?

*Note: The current version of `{omicser}` BLA BLAH BLAH.*

`{omicser}` is a **browser for simplifying the hypothesizign, browsing, and sharing of a `omic` data**.  Types of `-omic` data could be transcript`-omics`, prote`-omic`, metabol`-omic` , lipid`-omic` , etc.
It focuses on creating a consistent and shared platform for browsing `-omic` data.

The stable release can be found on ~~CRAN~~ and installed with:

~~`install.packages("omicser")`~~

The `{golem}` development version can be found on GitHub and installed with:

```{r 01-omicser-2, eval=FALSE}
remotes::install_github("ergonyc/omicser")
```

This repository will soon be transferred to NDCN.  The version of the package used while writing this was:

```{r 01-omicser-3}
packageVersion("omicser")
```


Some things to keep in mind before using `{omicser}`:

-   The `{omicser}` application is contained inside a package.
    
-   A `{omicser}` app is built with `shiny modules`, rather than a mono-lithic app / server.


## Understanding `{omicser}` app structure

**The `{omicser}` application is an R package**.
Having an R package architecture is perfectly suited for production-ready deploymentr.

Let's focus on the architecture of the default `{omicser}` app, and present the role that each file plays and how you can use (or not use) each of them.

```{r 01-omicser-4, include=FALSE}
library(magrittr)
```

The repository is layed out in a specific architecture:

```{r 01-omicser-4, eval = FALSE}
# Listing the files from the `omicser` project using {fs}
fs::dir_tree(".")
```

If you are familiar with building R packages, this structure will look familiar to you.
And for a good reason: a `{golem}` app IS a package.

### `DESCRIPTION` and `NAMESPACE`

The `DESCRIPTION` and `NAMESPACE` are **standard package files** (*i.e.* they are not `{golem}`-specific).
In `DESCRIPTION`, you will add a series of metadata about your package, for example, who wrote the package, what is the package version, what is its goal, who to complain to if things go wrong, and also information about external dependencies, the license, the encoding, and so forth.

This `DESCRIPTION` file will be filled automatically by the first function you will run in `dev/01_start.R`, and by other functions from the `dev/` scripts.
In other words, most of the time you will not interact with it directly, but through wrappers from `{golem}` and `{usethis}` [@R-usethis] which are listed in the `dev` scripts.

The `NAMESPACE` file is the file you will NEVER edit by hand!
**It defines how to interact with the rest of the package**: what functions to import and from which package and what functions to export, *i.e.* what functions are available to the user when you do `library(golex)`.
This file will be built when running the documenting process in your R package, i.e. when doing `devtools::document()`, or more specifically in our case `golem::document_and_reload()`.
This process will build the `man/` files and fill the `NAMESPACE`, by scanning the `{roxygen}` tags in your `.R` files.

If you want to learn more about these files, here are some resources you can refer to:

-   [Writing R Extensions—The DESCRIPTION file](https://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file)
-   [Writing R Extensions—Package namespaces](https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Package-namespaces)
-   [R Packages—Package metadata](https://r-pkgs.org/description.html#)
-   [R Packages—Namespace](https://r-pkgs.org/namespace.html)
-   [Building a package that lasts—eRum 2018 workshop](https://speakerdeck.com/colinfay/building-a-package-that-lasts-erum-2018-workshop)

### R/

The `R/` folder is **the standard folder where you will store all your app functions**.
When you start your project with `{golem}`, this folder is pre-populated with three `.R` files: `app_config.R`, `app_server.R`, `app_ui.R` and `run_app.R`.

During the process of building your application, all the core functionalities of your app will be stored in this `R/` directory, which is the standard way to store functions when using the R package framework.
Note that these files are the "core" features of your application itself, and that other .R files also exists.
For example, when you will need to deploy your application on RStudio platforms, `{golem}` will create an `app.R` at the root of your directory.[^golem-1]
The `dev/` folder also contains `.R` scripts, and they are inside this folder as they should not live inside the `R/` folder: they are utilitarian files used during development, not core functionalities of your application.

[^golem-1]: `{golem}` will automatically add this file to the `.Rbuildignore` file, i.e. make it be ignored by the package build process.

Inside these `.R` files, contained inside the `R/` folder, you will find the content of your modules (the one added with `golem::add_modules()`) and the utilitarian/business logic functions, built with `golem::add_utils()` and `golem::add_fct()`.

Note also that this folder must not contain any sub-folders.

#### app\_config.R {.unnumbered}

``` {.r}
#' Access files in the current app
#' 
#' NOTE: If you manually change your package 
#' name in the DESCRIPTION, don't forget to change it here too,
#' and in the config file. For a safer name change mechanism, 
#' use the `golem::set_golem_name()` function.
#' 
#' @param ... character vectors, specifying subdirectory 
#' and file(s) within your package. 
#' The default, none, returns the root of the app.
#' 
#' @noRd
app_sys <- function(...){
  system.file(..., package = "golex")
}
#' Read App Config
#' 
#' @param value Value to retrieve from the config file. 
#' @param config GOLEM_CONFIG_ACTIVE value. 
#' If unset, R_CONFIG_ACTIVE.  If unset, "default".
#' @param use_parent Logical, 
#' scan the parent directory for config file.
#' 
#' @noRd
get_golem_config <- function(
  value, 
  config = Sys.getenv(
    "GOLEM_CONFIG_ACTIVE", 
    Sys.getenv(
      "R_CONFIG_ACTIVE", 
      "default"
    )
  ), 
  use_parent = TRUE
){
  config::get(
    value = value, 
    config = config, 
    # Modify this if your config file is somewhere else:
    file = app_sys("golem-config.yml"), 
    use_parent = use_parent
  )
}
```

The `app_config.R` file contains internal mechanics for `{golem}`, notably for referring to values in the `inst/` folder, and to get values from the config file in the `inst/` folder.
Keep in mind that if ever you need to change the name of your application, you will need to change it inside the `DESCRIPTION`, but also inside the `app_sys()` function.
To make this process easier, you can use the `golem::set_golem_name()`, which will perform both these actions, plus setting the name inside the config file.
