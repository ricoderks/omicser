---
title: "1-Environment Setup"
author: "andy henrie"
date: "9/14/2021"
output:
  html_document: 
    toc: yes
    keep_md: yes
  md_document:
    variant: gfm
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Creating and running your own browser requires both Python and R.
We provide two different options for installing and setting up 
the environment you'll use when creating your browser:

- [Setup via R](#setup-via-r)
- [Setup via command line](#setup-via-command-lin)

Both methods require prior installation of R and RStudio.
This project was developed using [R](https://www.r-project.org/) version 4.1.0 and [RStudio](https://www.rstudio.com/products/rstudio/download/) v1.4.1717.

## Setup via R

### Python

The browser app looks for a conda environment so first we need to have miniconda or anaconda installed. (Please file a bug or a pull request to begin the process of supporting other python environments.)  If you don't already have anaconda or mini-conda, its easy to [install](https://conda.io/projects/conda/en/latest/user-guide/install/index.html).

Or, if you prefer to do everything in R, it can be installed via `reticulate`. 

The browser uses python to manage the data on the back end an we require v3.9. 

## R

Our first step will be to install `devtools`, and `reticulate`.  When we install the `omicser` browser package we can leverage the dependencies to get everything else we might need.

```{r, RM-install, eval=FALSE}

install.packages("devtools")
install.packages("reticulate")
```

Now, to use R to create your environment using `reticulate`:

```{r RM-r_env, eval=FALSE}
YOUR_CONDA_ENV <- "omxr"
PYTHON_VERSION <- 3.9

require(reticulate)
reticulate::install_miniconda() 
reticulate::conda_create(YOUR_CONDA_ENV, python_version = PYTHON_VERSION)
```

Now that we have conda and our environment available we need to install two packages to do everything contained in the example scripts.

(Warning: if you have bioconductor configured as a channel it may cause problems.  Forcing install from the "conda-forge" channel is preferred)

```{r RM-r_scanpy, eval=FALSE}
YOUR_CONDA_ENV <- "omxr"
reticulate::conda_install(envname = YOUR_CONDA_ENV, packages = "scanpy")
reticulate::conda_install(envname= YOUR_CONDA_ENV,
                          channel = "conda-forge",
                          packages = c("leidenalg") )
```

And we are now ready for [Installation](02_install.md). 


## Setup via command line

If you prefer to work on the command line,
the following instructions demonstrate how to use the shell to set up your environment
(examples for MacOSX):

First, download and install miniconda:

```{bash, conda_inst, eval = FALSE}
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O ~/miniconda.sh
bash ~/miniconda.sh -b -p $HOME/miniconda
```

Now we can use conda to install a python 3.9 environment to use with `reticulate`. 
For this example we've called the environment `omxr`.
Installing the python packages `scanpy` and `leidenalg` will ensure all additional python requirements are installed:

```{bash, conda_env, eval = FALSE}
conda create --name omxr python=3.9 -c bioconda -c conda-forge scanpy                                                                             
conda install -c conda-forge leidenalg                                                                                  
conda activate omxr
```
